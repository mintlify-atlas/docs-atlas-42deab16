---
title: 'Treesitter'
description: 'Advanced syntax highlighting and code understanding'
icon: 'code'
---

## Overview

[nvim-treesitter](https://github.com/nvim-treesitter/nvim-treesitter) provides advanced syntax highlighting, code navigation, and semantic understanding of your code. It uses tree-sitter parsers to build a syntax tree of your code, enabling features far beyond traditional regex-based highlighting.

<Note>
Treesitter is the foundation for many modern Neovim features including accurate syntax highlighting, smart text objects, code folding, and more.
</Note>

## Why Treesitter?

Advantages over traditional syntax highlighting:

- **Accurate**: Understands code structure, not just patterns
- **Fast**: Incremental parsing updates only changed sections
- **Consistent**: Same highlighting across all file types
- **Powerful**: Enables advanced features like smart selections and code navigation

## Installation

From `lua/leyland/plugins/treesitter.lua`:

```lua
return {
  "nvim-treesitter/nvim-treesitter",
  branch = "master",
  event = { "BufReadPre", "BufNewFile" },
  build = ":TSUpdate",
}
```

### Lazy Loading

```lua
event = { "BufReadPre", "BufNewFile" },
```

Treesitter loads when opening or creating files, not on Neovim startup. This keeps startup time fast.

### Auto-Update

```lua
build = ":TSUpdate",
```

Automatically runs `:TSUpdate` after installation to ensure all parsers are up-to-date.

## Configuration

### Installed Languages

From `lua/leyland/plugins/treesitter.lua`:

```lua:lua/leyland/plugins/treesitter.lua
require("nvim-treesitter").setup({
  ensure_installed = {
    "json",
    "javascript",
    "typescript",
    "tsx",
    "yaml",
    "html",
    "css",
    "prisma",
    "markdown",
    "markdown_inline",
    "svelte",
    "graphql",
    "bash",
    "lua",
    "vim",
    "dockerfile",
    "gitignore",
    "query",
    "vimdoc",
    "c",
  },
})
```

<Tabs>
  <Tab title="Web Development">
    ```lua
    "javascript",
    "typescript",
    "tsx",
    "html",
    "css",
    "svelte",
    "graphql",
    ```
    
    Full support for modern web frameworks and technologies.
  </Tab>
  
  <Tab title="Data & Config">
    ```lua
    "json",
    "yaml",
    "prisma",
    "dockerfile",
    "gitignore",
    ```
    
    Configuration files and data formats commonly used in projects.
  </Tab>
  
  <Tab title="Documentation">
    ```lua
    "markdown",
    "markdown_inline",
    "vimdoc",
    ```
    
    Enhanced highlighting for documentation files.
  </Tab>
  
  <Tab title="System & Core">
    ```lua
    "bash",
    "lua",
    "vim",
    "c",
    "query",
    ```
    
    System languages and Neovim configuration.
  </Tab>
</Tabs>

### Language Registration

```lua:lua/leyland/plugins/treesitter.lua
vim.treesitter.language.register("bash", "zsh")
```

Uses the bash parser for zsh files, providing syntax highlighting for zsh scripts.

## What Treesitter Provides

### 1. Syntax Highlighting

Treesitter-based highlighting is more accurate than regex:

<CodeGroup>
```typescript Without Treesitter
// Basic regex highlighting
const getValue = async () => {
  return await fetchData();
};
// 'const', 'async', 'await', 'return' highlighted
// But no semantic understanding
```

```typescript With Treesitter
// Semantic highlighting
const getValue = async () => {
  return await fetchData();
};
// ^^^^^ keyword
//    ^^^^^^^^ function name
//                ^^^^^ keyword (async)
//                         ^^^^^ keyword (await)
//                               ^^^^^^^^^ function call
```
</CodeGroup>

### 2. Code Structure Understanding

Treesitter builds a syntax tree:

```lua
function_declaration
├── name: "getValue"
├── parameters: ()
└── body:
    └── return_statement
        └── await_expression
            └── call_expression
                └── function: "fetchData"
```

This enables features like:
- Smart text objects
- Code folding
- Incremental selection
- Navigation by syntax nodes

### 3. Multi-Language Support

Treesitter handles embedded languages:

```vue
<template>
  <!-- HTML with Treesitter -->
  <div class="container">{{ message }}</div>
</template>

<script>
// JavaScript with Treesitter
export default {
  data() {
    return { message: 'Hello' }
  }
}
</script>

<style>
/* CSS with Treesitter */
.container {
  padding: 1rem;
}
</style>
```

Each section gets proper highlighting for its language.

## Managing Parsers

### Install Additional Parsers

```vim
:TSInstall python
:TSInstall rust
:TSInstall go
```

### Update All Parsers

```vim
:TSUpdate
```

Updates all installed parsers to latest versions.

### Check Installation Status

```vim
:TSInstallInfo
```

Shows which parsers are installed:

```
Treesitter Parsers
━━━━━━━━━━━━━━━━━━━━━━━━
  ✓ javascript
  ✓ typescript  
  ✓ lua
  ✗ python (not installed)
  ✗ rust (not installed)
```

### Uninstall Parser

```vim
:TSUninstall python
```

<Warning>
Uninstalling a parser removes syntax highlighting for that language. Only uninstall parsers you don't use.
</Warning>

## Highlighting Examples

### JavaScript/TypeScript

```typescript
// Function declarations
function calculateTotal(items: Item[]): number {
//       ^^^^^^^^^^^^^^ function.name
//                      ^^^^^ type
  const total = items.reduce((sum, item) => sum + item.price, 0);
  //    ^^^^^ variable
  //            ^^^^^ variable
  //                  ^^^^^^ method
  //                            ^^^ parameter
  //                                 ^^^^ parameter  
  return total;
}

// Async/await
async function fetchData(): Promise<Data> {
//^^^ keyword
  const response = await fetch('/api/data');
  //              ^^^^^ keyword
  //                    ^^^^^ function
  return response.json();
}
```

### Lua (Neovim Config)

```lua
-- Plugin configuration
return {
  "neovim/nvim-lspconfig",
  config = function()
  -- ^^^^^ keyword
    local lspconfig = require("lspconfig")
    --    ^^^^^^^^^ variable
    --                ^^^^^^^ function
    
    lspconfig.lua_ls.setup({
    -- ^^^^^^^ module
    --        ^^^^^^ property
      settings = {
        Lua = {
          diagnostics = {
            globals = { "vim" }
          }
        }
      }
    })
  end,
}
```

### React/TSX

```tsx
// Component with props
interface ButtonProps {
  label: string;
  onClick: () => void;
}

export const Button: React.FC<ButtonProps> = ({ label, onClick }) => {
//     ^^^^^ keyword
//           ^^^^^^ component.name
//                   ^^^^^^^^^^^^^^^^^^^^^^^ type
  return (
    <button onClick={onClick} className="btn">
      {label}
      {/* ^^^^^ variable in JSX */}
    </button>
  );
};
```

### Markdown

```markdown
# Heading 1
## Heading 2
### Heading 3

**Bold text** and *italic text*

- List item 1
- List item 2

1. Numbered item
2. Another item

`inline code` and code blocks:

\`\`\`javascript
const example = "highlighted code";
\`\`\`

[Link text](https://example.com)

![Image alt](image.png)
```

## Treesitter Commands

### Highlight Information

```vim
:TSHighlightCapturesUnderCursor
```

Shows what Treesitter calls the element under cursor:

```
Treesitter Captures
━━━━━━━━━━━━━━━━━━━
  @function.name
  @function
  @declaration
```

Useful for creating custom colorschemes.

### Playground

```vim
:TSPlaygroundToggle
```

Opens a split showing the syntax tree (requires `nvim-treesitter/playground` plugin).

### Module Status

```vim
:TSModuleInfo
```

Shows enabled Treesitter modules:

```
Treesitter Modules
━━━━━━━━━━━━━━━━━━
  ✓ highlight
  ✓ incremental_selection  
  ✗ indent (disabled)
```

## Advanced Features

### Incremental Selection

Use Treesitter for smart text selection (requires configuration):

```lua
incremental_selection = {
  enable = true,
  keymaps = {
    init_selection = "<CR>",
    node_incremental = "<CR>",
    node_decremental = "<BS>",
  },
},
```

Press `<Enter>` repeatedly to expand selection by syntax nodes:

```typescript
const result = calculateTotal(items);
//             ^^^^^^^^^^^^^^ first press
//             ^^^^^^^^^^^^^^^^^^^^^^ second press
//    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ third press
```

### Text Objects

Treesitter enables smart text objects (requires `nvim-treesitter/nvim-treesitter-textobjects`):

```lua
textobjects = {
  select = {
    enable = true,
    keymaps = {
      ["af"] = "@function.outer",
      ["if"] = "@function.inner",
      ["ac"] = "@class.outer",
      ["ic"] = "@class.inner",
    },
  },
},
```

Now you can:
- `daf` - Delete entire function
- `vif` - Select inside function
- `yac` - Yank entire class

### Code Folding

Use Treesitter for syntax-aware folding:

```lua
vim.opt.foldmethod = "expr"
vim.opt.foldexpr = "nvim_treesitter#foldexpr()"
```

Fold based on code structure, not indentation.

## Language-Specific Features

### TypeScript

- Distinguishes types from values
- Highlights generics correctly
- Understands decorators
- Proper JSX/TSX support

### Lua

- Neovim API highlighting
- Proper string interpolation
- Table constructor understanding
- Module system awareness

### Markdown

- Code fence language detection
- Embedded code highlighting
- Link and image recognition
- List and heading hierarchy

## Troubleshooting

<AccordionGroup>
  <Accordion title="No syntax highlighting">
    Check if parser is installed:
    
    ```vim
    :TSInstallInfo
    ```
    
    If missing, install it:
    
    ```vim
    :TSInstall <language>
    ```
  </Accordion>
  
  <Accordion title="Highlighting looks wrong">
    Try updating parsers:
    
    ```vim
    :TSUpdate
    ```
    
    If still broken, reinstall specific parser:
    
    ```vim
    :TSUninstall javascript
    :TSInstall javascript
    ```
  </Accordion>
  
  <Accordion title="Parser compilation failed">
    Ensure you have a C compiler:
    
    ```bash
    # macOS
    xcode-select --install
    
    # Ubuntu/Debian  
    sudo apt install build-essential
    
    # Arch
    sudo pacman -S base-devel
    ```
    
    Then reinstall parsers:
    
    ```vim
    :TSInstall! <language>
    ```
  </Accordion>
  
  <Accordion title="Slow performance in large files">
    Treesitter can be slow in very large files. Disable it temporarily:
    
    ```vim
    :TSBufDisable highlight
    ```
    
    Or set a file size limit in config:
    
    ```lua
    highlight = {
      enable = true,
      disable = function(lang, buf)
        local max_filesize = 100 * 1024 -- 100 KB
        local ok, stats = pcall(vim.loop.fs_stat, vim.api.nvim_buf_get_name(buf))
        if ok and stats and stats.size > max_filesize then
          return true
        end
      end,
    },
    ```
  </Accordion>
</AccordionGroup>

## Adding New Languages

To add support for a new language:

<Steps>
  <Step title="Check Parser Availability">
    Visit [Tree-sitter language list](https://github.com/nvim-treesitter/nvim-treesitter#supported-languages)
  </Step>
  
  <Step title="Install Parser">
    ```vim
    :TSInstall <language>
    ```
  </Step>
  
  <Step title="Add to Config (Optional)">
    For automatic installation:
    
    ```lua
    ensure_installed = {
      -- ... existing languages
      "python",
      "rust",
      "go",
    },
    ```
  </Step>
  
  <Step title="Verify Installation">
    Open a file in that language and check highlighting:
    
    ```vim
    :TSHighlightCapturesUnderCursor
    ```
  </Step>
</Steps>

## Performance Impact

Treesitter is generally fast, but has some overhead:

### Startup Time

```lua
event = { "BufReadPre", "BufNewFile" },
```

Lazy-loads on file open, not on Neovim startup, minimizing impact.

### File Loading

Treesitter parses files when opened:

- Small files (<10KB): Imperceptible
- Medium files (10-100KB): Slight delay
- Large files (>100KB): Noticeable parsing time

### Incremental Updates

Editing is fast due to incremental parsing - only changed portions are reparsed.

## Integration with Other Plugins

### LSP

Treesitter complements LSP:

- **Treesitter**: Syntax highlighting, text objects
- **LSP**: Semantic tokens, go to definition, errors

Both work together for the best experience.

### Telescope

Treesitter can provide symbols for Telescope:

```vim
:Telescope treesitter
```

Shows all functions, classes, etc. in current file.

### nvim-cmp

Treesitter powers some completion sources:

```lua
sources = {
  { name = 'treesitter' },
}
```

## Related Plugins

<CardGroup cols={2}>
  <Card title="LSP" icon="code" href="/lsp/setup">
    Language server integration
  </Card>
  
  <Card title="Colorschemes" icon="palette" href="/plugins/colorschemes">
    Themes that leverage Treesitter
  </Card>
</CardGroup>

## Source Code

View the full configuration:
```
lua/leyland/plugins/treesitter.lua
```